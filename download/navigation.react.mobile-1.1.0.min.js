/**
 * Navigation React Mobile v1.1.0
 * (c) Graham Mendick - http://grahammendick.github.io/navigation/
 * License: Apache-2.0
 */
!function(t,e,n,r){"use strict";function o(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},s=function(t){function e(e,n){var r=t.call(this,n||"")||this;return r.hash=!1,r.buildCurrentUrl=e,r.hash=void 0===n,r}return o(e,t),e.prototype.getHref=function(e){var n=e.indexOf("?");if(n>=0){for(var r=e.substring(0,n),o=e.substring(n+1),a=o.split("&"),i=[],s=0;s<a.length;s++)"crumb="!==a[s].substring(0,6)&&i.push(a[s]);var u=i.join("&");e=""+r+(u&&"?")+u}return this.hash?"#"+e:t.prototype.getHref.call(this,e)},e.prototype.getUrl=function(e){return this.hash?e.hash.substring(1):t.prototype.getUrl.call(this,e)},e.prototype.getCurrentUrl=function(){var t=this.getUrl(location);return this.buildCurrentUrl&&(t=this.buildCurrentUrl(t)),t},e}(e.HTML5HistoryManager),u=function(t){function e(e,n){var r=t.call(this,e,n)||this;r.move=r.move.bind(r);var o=r.props,a=o.data,i=o.enter,s=o.getKey,u=a.map(function(t){var e={key:s(t),data:t,progress:1,tick:0};return e.start=e.end=e.style=i(t),e});return r.state={items:u},r}return o(e,t),e.prototype.componentWillReceiveProps=function(){this.moveId||(this.moveId=requestAnimationFrame(this.move))},e.prototype.componentDidMount=function(){this.moveId=requestAnimationFrame(this.move)},e.prototype.componentWillUnmount=function(){cancelAnimationFrame(this.moveId)},e.prototype.move=function(t){var e=this;this.setState(function(n){var r=n.items,o=e.props,a=o.data,s=o.enter,u=o.leave,l=o.update,c=o.progress,p=o.getKey,h=o.duration,d=o.onRest,m=a.reduce(function(t,e,n){return i({},t,(r={},r[p(e)]=i({},e,{index:n}),r));var r},{}),f=r.reduce(function(t,e){return i({},t,(n={},n[e.key]=e,n));var n},{}),g=r.map(function(n,r){var o=m[n.key],i={key:n.key,data:o||n.data,tick:t};i.end=o?l(o):(u||l)(n.data),i.index=o?o.index:a.length+r;var s=e.areEqual(n.end,i.end);if(s){i.start=n.start,i.rest=1===n.progress;var p=(i.tick-n.tick)/h;i.progress=Math.min(n.progress+p,1)}else{i.rest=!1;var f=!s&&e.areEqual(n.start,i.end);i.start=f?n.end:c?n.start:n.style,i.progress=f?1-n.progress:c}return i.style=e.interpolateStyle(i),d&&i.rest&&!n.rest&&d(n.data),i}).filter(function(t){return m[t.key]||!t.rest&&u}).concat(a.filter(function(t){return!f[p(t)]}).map(function(e){var n=m[p(e)].index,r={key:p(e),data:e,progress:c,tick:t,rest:!1,index:n};return r.start=r.style=s(e),r.end=l(e),r})).sort(function(t,e){return t.index-e.index});return e.moveId=null,0!==g.filter(function(t){return!t.rest}).length&&(e.moveId=requestAnimationFrame(e.move)),{items:g}})},e.prototype.areEqual=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(t[n]!==e[n])return!1;return!0},e.prototype.interpolateStyle=function(t){var e=t.start,n=t.end,r=t.progress,o={};for(var a in n)o[a]=e[a]+r*(n[a]-e[a]);return o},e.prototype.render=function(){return this.props.children(this.state.items)},e.defaultProps={progress:0},e}(n.Component),l=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.index=e.stateNavigator.stateContext.crumbs.length,r}return o(e,t),e.prototype.shouldComponentUpdate=function(t){return this.index===this.props.stateNavigator.stateContext.crumbs.length},e.prototype.render=function(){return this.props.children},e}(n.Component),c=function(t){return function(e){return n.createElement(r.NavigationContext.Consumer,null,function(r){var o=r.stateNavigator;return n.createElement(t,i({stateNavigator:o},e))})}},p=function(t){function e(e,r){var o=t.call(this,e,r)||this;o.sharedElements={},o.onNavigate=o.onNavigate.bind(o),o.registerSharedElement=o.registerSharedElement.bind(o),o.unregisterSharedElement=o.unregisterSharedElement.bind(o);var a={},i=o.getStateNavigator(),s=i.stateContext,u=s.state,c=s.data,p=s.crumbs;return u&&(a[p.length]=n.createElement(l,{stateNavigator:i},u.renderScene(c))),o.state={scenes:a,rest:!1},o}return o(e,t),e.prototype.getChildContext=function(){return{registerSharedElement:this.registerSharedElement,unregisterSharedElement:this.unregisterSharedElement}},e.prototype.getStateNavigator=function(){return this.context.stateNavigator||this.props.stateNavigator},e.prototype.componentDidMount=function(){this.getStateNavigator().onNavigate(this.onNavigate)},e.prototype.componentWillUnmount=function(){this.getStateNavigator().offNavigate(this.onNavigate)},e.prototype.onNavigate=function(t,e,r){var o=this;this.setState(function(t){var a=t.scenes,s=i({},a),u=o.getStateNavigator();return s[u.stateContext.crumbs.length]=n.createElement(l,{stateNavigator:u},e.renderScene(r)),{scenes:s,rest:!1}})},e.prototype.registerSharedElement=function(t,e,n,r){this.sharedElements[t]=this.sharedElements[t]||{},this.sharedElements[t][e]={ref:n,data:r}},e.prototype.unregisterSharedElement=function(t,e){this.sharedElements[t]&&delete this.sharedElements[t][e]},e.prototype.getSharedElements=function(t,e){if(null===e||t.length===e.split("crumb=").length-1)return[];var n=this.sharedElements[e.split("crumb=").length-1],r=this.sharedElements[t.length],o=[];for(var a in r)n&&n[a]&&o.push({name:a,oldElement:n[a],mountedElement:r[a]});return o},e.prototype.clearScene=function(t){var e=this;this.setState(function(n){var r=n.scenes,o=n.rest,a=i({},r),s=e.getScenes().filter(function(e){return e.key===t})[0];return s||(delete a[t],delete e.sharedElements[t]),{scenes:a,rest:o||s&&s.mount}})},e.prototype.getScenes=function(){var t=this,e=this.getStateNavigator().stateContext,n=e.crumbs,r=e.nextCrumb;return n.concat(r).map(function(e,n,o){var a=e.state,i=e.data,s=e.url,u=o.slice(0,n),l=o[n+1];return{key:n,state:a,data:i,url:s,crumbs:u,nextState:l&&l.state,nextData:l&&l.data,scene:t.state.scenes[n],mount:s===r.url}})},e.prototype.getStyle=function(t,e){var n=e.state,r=e.data,o=e.crumbs,a=e.nextState,i=e.nextData,s=e.mount,u=this.props,l=u.unmountedStyle,c=u.mountedStyle,p=u.crumbStyle,h=t?s?c:p:l;return"function"==typeof h?h(n,r,o,a,i):h},e.prototype.render=function(){var t=this,e=this.props,r=e.children,o=e.duration,a=e.sharedElementMotion,i=this.getStateNavigator(),s=i.stateContext,l=s.crumbs,c=s.oldUrl,p=s.oldState,h=i.stateContext,d=u;return h.state&&n.createElement(d,{data:this.getScenes(),getKey:function(t){return t.key},enter:function(e){return t.getStyle(!p,e)},update:function(e){return t.getStyle(!0,e)},leave:function(e){return t.getStyle(!1,e)},onRest:function(e){var n=e.key;return t.clearScene(n)},duration:o},function(e){return e.map(function(t){var e=t.data,n=e.key,o=e.scene,a=e.state,i=e.data,s=(e.url,t.style);return r(s,o,n,l.length===n,a,i)}).concat(a&&a({key:"sharedElements",sharedElements:t.state.rest?[]:t.getSharedElements(l,c),progress:e[l.length]&&e[l.length].progress,duration:o}))})},e.defaultProps={duration:300},e.contextTypes={stateNavigator:function(){return null}},e.childContextTypes={registerSharedElement:function(){return null},unregisterSharedElement:function(){return null}},e}(n.Component),h=c(p),d=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scene=r.getStateNavigator().stateContext.crumbs.length,r.register=r.register.bind(r),r}return o(e,t),e.prototype.getStateNavigator=function(){return this.context.stateNavigator||this.props.stateNavigator},e.prototype.componentDidMount=function(){this.register()},e.prototype.componentDidUpdate=function(t){this.context.unregisterSharedElement(this.scene,t.name),this.register()},e.prototype.componentWillUnmount=function(){this.context.unregisterSharedElement(this.scene,this.props.name)},e.prototype.register=function(){var t=this.getStateNavigator().stateContext,e=t.crumbs,n=t.oldUrl;if(this.scene===e.length||n&&this.scene===n.split("crumb=").length-1){var r=this.props,o=r.unshare,a=r.name,i=r.data;o?this.context.unregisterSharedElement(this.scene,a):this.ref&&this.context.registerSharedElement(this.scene,a,this.ref,i)}},e.prototype.render=function(){var t=this;return n.cloneElement(this.props.children,{ref:function(e){return t.ref=e}})},e.contextTypes={stateNavigator:function(){return null},registerSharedElement:function(){return null},unregisterSharedElement:function(){return null}},e}(n.Component),m=c(d),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.componentWillReceiveProps=function(t){var e=this.getSharedElements(t.sharedElements),n=this.getSharedElements(this.props.sharedElements);this.diff(n,e,this.props.onAnimated),this.diff(e,n,this.props.onAnimating)},e.prototype.diff=function(t,e,n){for(var r in t){var o=t[r],a=e[r];a&&o.mountedElement.ref===a.mountedElement.ref||(n&&n(r,o.oldElement.ref,o.oldElement.data),n&&n(r,o.mountedElement.ref,o.mountedElement.data))}},e.prototype.getSharedElements=function(t){return t.reduce(function(t,e){return i({},t,(n={},n[e.name]=e,n));var n},{})},e.prototype.getStyle=function(t,e){var n=e.ref,r=e.data,o=n.getBoundingClientRect(),a=o.top,s=o.left,u=o.width,l=o.height;return this.props.elementStyle(t,n,i({top:a,left:s,width:u,height:l},r))},e.prototype.getPropValue=function(t,e){return"function"==typeof t?t(e):t},e.prototype.render=function(){var t=this,e=this.props,r=e.sharedElements,o=e.children,a=e.progress,i=e.duration,s=u;return 0!==r.length&&n.createElement(s,{data:r,getKey:function(t){return t.name},enter:function(e){var n=e.name,r=e.oldElement;return t.getStyle(n,r)},update:function(e){var n=e.name,r=e.mountedElement;return t.getStyle(n,r)},progress:a,duration:i},function(t){return t.map(function(t){var e=t.data,n=e.name,r=e.oldElement,a=e.mountedElement,i=t.style;return o(i,n,r.data,a.data)})})},e.defaultProps={duration:300,elementStyle:function(t,e,n){return n}},e}(n.Component);t.MobileHistoryManager=s,t.NavigationMotion=h,t.SharedElement=m,t.SharedElementMotion=f}(this.NavigationReactMobile=this.NavigationReactMobile||{},Navigation,React,NavigationReact);