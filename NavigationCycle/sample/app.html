<!DOCTYPE html>
<html>
<head>
    <title>Navigation Cycle</title>
    <style>
        table{border-collapse:collapse;}table,td,th{border:1px #000 solid;}
        ul{list-style-type:none;padding:0;margin:0;}li{float:left;padding-right:3px;}
        .active{font-weight:bold;}
    </style>
</head>
<body>
    <div id="content"></div>
    <script src="../../NavigationJS/sample/personSearch.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/4.0.6/rx.all.js"></script>
    <script src="https://rawgit.com/cyclejs/cycle-core/master/dist/cycle.js"></script>
    <script src="https://rawgit.com/cyclejs/cycle-dom/master/dist/cycle-dom.js"></script>
    <script>
        var h = CycleDOM.h;
        
        function listIntent(sources) {
            return Rx.Observable.of(personSearch.search());
        }
        
        function listMain(sources) {
            var people$ = listIntent(sources);
            return {
                DOM: people$.map(people => h('div', [
                    h('table', [
                        h('tr', [
                            h('th', 'Name'),
                            h('th', 'Date of Birth')                            
                        ])]
                        .concat(people.map(person =>
                        h('tr', [
                            h('td', person.name),
                            h('td', person.dateOfBirth)
                        ])))
                    ),
                    h('button', 'Details')
                ]))
            };
        }
        
        function detailsIntent(sources) {
            return Rx.Observable.of(personSearch.getDetails(1));
        }
        
        function detailsMain(sources) {
            var person$ = detailsIntent(sources);
            return {
                DOM: person$.map(person => h('div', [
                    h('span', 'Name:' + person.name),
                    h('br'),
                    h('span', 'Date of birth:' + person.dateOfBirth),
                    h('button', 'List')
                ]))
            };
        }
        
        function main(sources) {
            var click$ = sources.DOM.select('button').events('click')
                .map(ev => ev.target.textContent.toLowerCase() + 'Main').startWith('listMain');
            return {
                DOM: click$.map(main => h('div', [
                    h('h1', 'Navigation Cycle'),
                    window[main](sources).DOM
                ]))
            };
        }
        
        Cycle.run(main, {
            DOM: CycleDOM.makeDOMDriver('#content')
        });        
    </script>
</body>
</html>
