<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Navigation KO</title>
    <script src="../../Sample/app.data.js"></script>
    <script src="../../Navigation.Routing.js"></script>
    <script src="../../Navigation.js"></script>
    <script src="../../Sample/Knockout/knockout-3.3.0.js"></script>
    <script src="../../Navigation.Knockout.js"></script>
    <style>
        table{border-collapse:collapse;}table,td,th{border:1px #000 solid;}
        ul{list-style-type:none;padding:0;margin:0;}li{float:left;padding-right:3px;}
    </style>
</head>
<body>
    <div>
        <label for="name">Name</label>
        <input id="name" data-bind="value: name" />
    </div>
    Page Size
    <a data-bind="refreshLink: { maximumRows: 5 }, includeCurrentData: true">5</a>
    <a data-bind="refreshLink: { maximumRows: 10 }, includeCurrentData: true">10</a>
    <table>
        <thead>
            <tr>
                <th><a data-bind="refreshLink: { sortExpression: sortExpression }, includeCurrentData: true">Name</a></th>
                <th>Date of Birth</th>
            </tr>
        </thead>
        <tbody data-bind="foreach: people">
            <tr>
                <td><a data-bind="text: name, navigationLink: 'select', toData: { id: id }"></a></td>
                <td data-bind="text: dateOfBirth.toLocaleDateString()"></td>
            </tr>
        </tbody>
    </table>
    <ul>
        <!-- ko if: previousVisible -->
            <li><a data-bind="refreshLink: { startRowIndex: 0 }, includeCurrentData: true">First</a></li>
            <li><a data-bind="refreshLink: { startRowIndex: previous }, includeCurrentData: true">Previous</a></li>
        <!-- /ko -->
        <!-- ko ifnot: previousVisible -->
            <li>First</li>
            <li>Previous</li>
        <!-- /ko -->
        <!-- ko if: nextVisible -->
            <li><a data-bind="refreshLink: { startRowIndex: next }, includeCurrentData: true">Next</a></li>
            <li><a data-bind="refreshLink: { startRowIndex: last }, includeCurrentData: true">Last</a></li>
        <!-- /ko -->
        <!-- ko ifnot: nextVisible -->
            <li>Next</li>
            <li>Last</li>
        <!-- /ko -->
    </ul>
    <script type="text/javascript">
        function PersonViewModel() {
            var self = this;
            self.name = ko.observable();
            self.people = ko.observableArray();
            self.sortExpression = ko.observable();
            self.previous = ko.observable();
            self.previousVisible = ko.observable();
            self.next = ko.observable();
            self.nextVisible = ko.observable();
            self.last = ko.observable();
            self.name.subscribe(function (val) {
                Navigation.StateController.refresh(Navigation.StateContext.includeCurrentData({ name: val }));
            });

	        var webMailStates = Navigation.StateInfoConfig.dialogs.person.states;
	        webMailStates.list.navigated = function (data) {
	            document.title = 'Person Search';
	            var people = search(data.name, data.sortExpression);
	            var totalRowCount = people.length;
	            people = people.slice(data.startRowIndex, data.startRowIndex + data.maximumRows);
	            self.people(people);
	            self.sortExpression(data.sortExpression.indexOf('DESC') === -1 ? 'Name DESC' : 'Name');
	            self.previous(data.startRowIndex - data.maximumRows);
	            self.previousVisible(self.previous() >= 0);
	            self.next(data.startRowIndex + data.maximumRows);
	            self.nextVisible(self.next() < totalRowCount);
	            var remainder = totalRowCount % data.maximumRows;
	            self.last(remainder != 0 ? totalRowCount - remainder : totalRowCount - dat.maximumRows)
	        };
	        webMailStates.list.dispose = function () { };
	        webMailStates.details.navigated = function (data) {
	        };
	        webMailStates.details.dispose = function () {  };
	        Navigation.start();
        };

        Navigation.StateInfoConfig.build([
	        { key: 'person', initial: 'list', states: [
		        { key: 'list', route: '{startRowIndex}/{maximumRows}/{sortExpression}', defaults: { startRowIndex: 0, maximumRows: 10, sortExpression: 'Name'}, trackCrumbTrail: false, transitions: [
			        { key: 'select', to: 'details' }]},
		        { key: 'details', route: 'person' }]}
        ]);
        ko.applyBindings(new PersonViewModel());
    </script>
</body>
</html>
