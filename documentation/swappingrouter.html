<html>
<head>
    <title>Swapping the Router</title>
    <link href="../github.css" rel="stylesheet" />
    <link href="documentation.css" rel="stylesheet" />
</head>
<body>
    <div id="header">
        <div id="banner">
            <a id="home" href="../index.html">Navigation</a>
            <a href="../tutorial/configuringstates.html">Tutorial</a>
            <a href="../example/angular/navigation.html">Examples</a>
            <a href="../download/index.html">Download</a>
            <a class="active" href="configuring.html">Documentation</a>
            <a href="https://github.com/grahammendick/navigation">GitHub Source</a>
        </div>
    </div>
    <div id="content">
        <div id="nav">
            <h3></h3>
            <ul>
                <li><a href="configuring.html">Configuring</a></li>
                <li><a href="changingstate.html">Changing State</a></li>
                <li><a href="managinghistory.html">Managing History</a></li>
                <li><a href="hyperlinking.html">Hyperlinking</a></li>
            </ul>
        </div>
        <div id="doc">
            <h1>Swapping the Router</h1>
            <p>
                If you don't like the built-in route pattern matching rules, you can swap in a different routing engine. Replacing Navigation's router
                sounds odd at first, but makes sense when you realise that all the logic sits in the State machine layer above the router.
            </p>
            <p>
                For example, Navigation doesn't support catch-all parameters but the <a href="http://millermedeiros.github.io/crossroads.js/">Crossroads router</a>
                does. If you plumb in Crossroads, you can define a route foo/{params*} that matches both 'foo/bar' and 'foo/bar/foo':
                <pre><code class="javascript">Navigation.settings.router = {
    // Return the state and data for the passed in route
    getData: function(route) {
        var data = {};
        // Ask crossroads for the matched route
        var match = crossroads._getMatchedRoutes(route)[0];
        for (var i = 0; i < match.params.length; i++) {
            data[match.route._paramsIds[i]] = decodeURIComponent(match.params[i]);
        }
        return { state: match.route._state, data: data };
    },
    // Return the route for the passed in state and data
    getRoute: function(state, data) {
        var encodedData = {};
        for (var key in data)
            encodedData[key] = encodeURIComponent(data[key]);
        // Ask crossroads to build the route
        var route = state._route.interpolate(encodedData);
        var routeData = this.getData(route).data;
        return { route: route, data: routeData };
    },
    // Add the configured routes to the underlying router
    addRoutes: function(dialogs) {
        crossroads.ignoreState = true;
        for (var i = 0; i < dialogs.length; i++) {
            for (var j = 0; j < dialogs[i]._states.length; j++) {
                // Attach the crossroads route to the state and vice versa
                var state = dialogs[i]._states[j];
                state._route = crossroads.addRoute(state.route);
                state._route._state = state;
            }
        }
    }
};</code></pre>
            </p>
            <p>
                <em>Make sure you set the custom router before calling <code>Navigation.StateInfoConfig.build(...);</code></em>
            </p>
        </div>
    </div>
    <script src="../highlight.pack.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script>
</body>
</html>