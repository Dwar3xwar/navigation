<html>
<head>
    <title>Configuring</title>
    <link href="../github.css" rel="stylesheet" />
    <link href="documentation.css" rel="stylesheet" />
</head>
<body>
    <div id="header">
        <div id="banner">
            <a id="home" href="../index.html">Navigation</a>
            <a href="../tutorial/configuringstates.html">Tutorial</a>
            <a href="../example/angular/navigation.html">Examples</a>
            <a href="../download/index.html">Download</a>
            <a class="active" href="historymanagement.html">Documentation</a>
            <a href="https://github.com/grahammendick/navigation">GitHub Source</a>
        </div>
    </div>
    <div id="content">
        <div id="nav">
            <h3></h3>
            <ul>
                <li class="active"><a href="configuring.html">Configuring</a></li>
                <li><a href="managinghistory.html">Managing History</a></li>
            </ul>
        </div>
        <div id="doc">
            <h1>Configuring</h1>
            <p>
                Navigation isn't like other routers. Other routers implement a State machine under the covers and make you pass in the route
                you want to navigate to. Navigation reverses this, by exposing the State machine layer and hiding away the route building.
                Navigation's State machine layer is made up of three elements:
            </p>
            <dl>
                <dt>State</dt>
                <dd>A view in your application</dd>
                <dt>Dialog</dt>
                <dd>A logical grouping of States</dd>
                <dt>Transition</dt>
                <dd>A navigation between States within the same Dialog</dd>
            </dl>
            <p>
                For example, in an email application, you need a State that lists your emails and one that shows a mail's details. You need to
                navigate from the list to the details. An 'inbox' Dialog that groups these two States would look like:
            <pre><code class="javascript">// inbox Dialog has two child States
// listing State has a child Transition to the details State
var inboxDialog = {
    key: 'inbox', initial: 'listing', states: [
        { key: 'listing', transitions: [
            { key: 'select', to: 'details' }
        ]},
        { key: 'details' }
    ]
}</code></pre>
            </p>
            <p>
                You also need a State for composing new emails. Because it's not related to your inbox activities, it would to go inside a new Dialog.
                Your list of Dialogs is then passed to Navigation:
                <pre><code class="javascript">Navigation.StateInfoConfig.build([ inboxDialog, composeDialog ]);</code></pre>
                <em>Your Dialogs and Transitions will come into play when <a href="changingstate.html">Changing State</a>.</em>
            </p>
            <h2>Router</h2>
            <p>
                The only time you ever refer to a route is during configuration. Each State must be assigned a route. As you move between States, Navigation
                keeps the Url in step with the current State's route. The route pattern matching rules are:
            </p>
            <dl>
                <dt>foo</dt>
                <dd>Matches 'foo' but not 'foo/bar'</dd>
                <dt>foo/{param}</dt>
                <dd>Matches 'foo/bar' but not 'foo'</dd>
                <dt>foo/{param?}</dt>
                <dd>Matches 'foo' and 'foo/bar'</dd>
            </dl>
            <p>
                Here's the inbox Dialog updated with routes set for the two States:
                <pre><code class="javascript">var inboxDialog = {
    key: 'inbox', initial: 'listing', states: [
        { key: 'listing', route: '', transitions: [
            { key: 'select', to: 'details' }
        ]},
        { key: 'details', route: 'mail/{id}' }
    ]
}</code></pre>
                <em>Optional parameters are covered in more detail in <a href="changingdata.html">Changing Data</a>.</em>
            </p>
            <h2>Custom Router</h2>
            <p>
                If you don't like the built in Router plugin your own.
                It doesn't have slugs so you might want to switch it for a one that does like [Crossroads].
                If you do then have to change route syntax to match your router. Have to call private
                method, might need to do the same? Crossroads example
                Need a function that turns a route into State and data and vice versa.
                <pre><code class="javascript">var crossroadsRouter = {
    getData: function(route) {
        var data = {};
        var match = crossroads._getMatchedRoutes(route)[0];
        for (var i = 0; i < match.params.length; i++) {
            data[match.route._paramsIds[i]] = decodeURIComponent(match.params[i]);
        }
        return { state: match.route._state, data: data };
    },
    getRoute: function(state, data) {
        var encodedData = {};
        for (var key in data)
            encodedData[key] = encodeURIComponent(data[key]);
        var route = state._route.interpolate(encodedData);
        var routeData = this.getData(route);
        return { route: route, data: routeData };
    },
    addRoutes: function(dialogs) {
        for (var i = 0; i < dialogs.length; i++) {
            for (var j = 0; j < dialogs[i]._states.length; j++) {
	    var state = dialogs[i]._states[j];
                state._route = crossroads.addRoute(state.route);
                state._route._state = state;
            }
        }
    }
}
crossroads.ignoreState = true;
Navigation.router = crossroadsRouter;</code></pre>
            </p>
            <p>
                Left as an exercise how to change addRoutes so that the blank route is added last to avoid matching everything.
                Set the custom router before configuring your Dialogs.
            </p>
        </div>
    </div>
    <script src="../highlight.pack.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script>
</body>
</html>