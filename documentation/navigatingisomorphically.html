<html>
<head>
    <title>Navigating Isomorphically</title>
    <link href="../github.css" rel="stylesheet" />
    <link href="documentation.css" rel="stylesheet" />
</head>
<body>
    <div id="header">
        <div id="banner">
            <a id="home" href="../index.html">Navigation</a>
            <a href="../tutorial/configuringstates.html">Tutorial</a>
            <a href="../example/angular/navigation.html">Examples</a>
            <a href="../download/index.html">Download</a>
            <a class="active" href="configuring.html">Documentation</a>
            <a href="https://github.com/grahammendick/navigation">GitHub Source</a>
        </div>
    </div>
    <div id="content">
        <div id="nav">
            <h3></h3>
            <ul>
                <li><a href="configuring.html">Configuring</a></li>
                <li><a href="changingstate.html">Changing State</a></li>
                <li><a href="changingdata.html">Changing Data</a></li>
                <li><a href="rememberingdata.html">Remembering Data</a></li>
                <li><a href="handlingnavigation.html">Handling Navigation</a></li>
                <li><a href="settingdatadefaults.html">Setting Data Defaults</a></li>
                <li><a href="hyperlinking.html">Hyperlinking</a></li>
                <li>
                    Working With:
                    <ul>
                        <li><a href="workingwith/angular.html">Angular</a></li>
                        <li><a href="workingwith/knockout.html">Knockout</a></li>
                        <li><a href="workingwith/react.html">React</a></li>
                    </ul>
                </li>
                <li><a href="unloadingviews.html">Unloading Views</a></li>
                <li><a href="managinghistory.html">Managing History</a></li>
                <li class="active"><a href="navigatingisomorphically.html">Navigating Isomorphically</a></li>
                <li><a href="layingcrumbtrail.html">Laying a Crumb Trail</a></li>
            </ul>
        </div>
        <div id="doc">
            <h1>Navigating Isomorphically</h1>
            <p>
                A typical single page web application only runs on the client. It sends an empty page from the server
                and renders all the HTML using JavaScript on the client. This approach suffers from performance and
                accessibility problems. Before any content is shown to the user all the JavaScript must be downloaded,
                parsed and executed. The time this takes is dependent on the client device and network, with mobile
                devices faring the worst. The HTML content is only available to devices that can run the requisite
                JavaScript. This excludes many users and most search engines.
            </p>
            <p>
                A single page web application is called isomorphic if it can run on both the client and the server. It
                renders the HTML content on the server first and then, once the JavaScript has been downloaded, the client
                takes over control to prevent full page reloads. Isomorphic web applications are fast and accessible.
            </p>
            <p>
                Navigation is an isomorphic router. The Navigation project on GitHub contains a 
                <a href="https://github.com/grahammendick/navigation/tree/master/NavigationReact/sample/isomorphic">sample isomorphic web application</a>
                written using Navigation and React. What follows is an explanation of the code found in that example.
            </p>
            <h2>Approach</h2>
            <p>
                The knack to writing isomorphic code is to make sure that creating and rendering your React Components is
                a synchronous process. Otherwise, on the server side, you'd have to somehow track your Components across
                callbacks in a stateless Node environment. The key to keeping this code synchronous is to move all asynchronous
                data retrieval out of your Components. That means fetching all your data up front and then passing it in as props
                for the Components to render.
            </p>
            <h2>Server</h2>
            <p>
                The server specific code is held in 
                <a href="https://github.com/grahammendick/navigation/blob/master/NavigationReact/sample/isomorphic/NavigationServer.js">NavigationServer.js</a>.
                On receipt of an http request the first thing it does is to set up the Navigation context by calling navigateLink
                and passing in the request Url. This ensures the right State is made active. It then retrieves the data relevant
                for the active State. The data retrieval process is asynchronous and so, on return, it resets the Navigation
                context with a repeated call to navigateLink. Then, it creates the Component for the active State, passing in the
                data as props. Finally, it renders the component as HTML into the response along with a JSON representation of the
                props used.
            </p>
            <h2>Client</h2>
            <p>
                The client specific code is held in
                <a href="https://github.com/grahammendick/navigation/blob/master/NavigationReact/sample/isomorphic/NavigationClient.js">NavigationClient.js</a>.
                On page load the first thing it does is to set up the Navigation context by calling start (under the covers this
                calls navigateLink passing in the browser Url). This ensures the right State is made active. It then creates the
                Component for the active State, passing in the props that the server emitted above. Then it renders the Component,
                allowing React to match up it's client-rendered version with the one returned from the server. Finally, it adds
                State Navigators so that the subsequent Hyperlink navigation takes place on the client.
            </p>
            <h2>Shared</h2>
            <p>
                The other three files are shared across both client and server. The Navigation configuration, used to set up the 
                Navigation context, is held in
                <a href="https://github.com/grahammendick/navigation/blob/master/NavigationReact/sample/isomorphic/NavigationShared.js">NavigationShared.js</a>.
                The React Components, rendered to a string on the server and to the DOM on the client, are held in
                <a href="https://github.com/grahammendick/navigation/blob/master/NavigationReact/sample/isomorphic/Component.js">Component.js</a>.
                The data access, called over Ajax on the client and as direct function calls on the server, is held in
                <a href="https://github.com/grahammendick/navigation/blob/master/NavigationReact/sample/isomorphic/Data.js">Data.js</a>.
            </p>
    </div>
    <script src="../highlight.pack.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script>
</body>
</html>