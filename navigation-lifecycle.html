<html>
<head>
    <title>Navigation Lifecycle</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="prism.css">
    <link rel="stylesheet" href="navigation.css">
</head>
<body>
    <div id="banner">
        <div>
            <a href="index.html">Navigation</a>
            <a href="hello-world.html" class="selected">Docs</a>
            <a href="#">Download</a>
            <a id="github" href="#">GitHub source</a>
        </div>
    </div>
    <div id="content">
        <div id="menu">
            <a href="hello-world.html">Hello World</a>
            <a href="tutorial.html">Tutorial</a>
            <div class="separator"></div>
            <h2>THE ABC's</h2>
            <a href="state-navigation.html">A. State Navigation</a>
            <a href="navigation-data.html">B. Navigation Data</a>
            <a href="routes.html">C. Routes</a>
            <div class="separator"></div>
            <h2>FURTHER GUIDES</h2>
            <a href="breadcrumb-trail.html">Breadcrumb Trail</a>
            <a href="current-data.html">Current Data</a>
            <a href="navigation-lifecycle.html" class="selected">Navigation Lifecycle</a>
            <a href="history.html">HTML5 History</a>
        </div>
        <div id="article">
            <h1>Navigation Lifecycle</h1>
            <p>
                You've seen how the Navigation router notifies you when a State becomes active by calling the function attached to the State's navigated property. This is how you render different components for different States. You can get notified at different points in the navigation lifecyle by attaching functions to different properties of the originating and destination States.
            </p>
            <h2>Cancelling Navigation</h2>
            <p>
                You can intercept a navigation by attaching a function to the originating State's unloading property. The navigation will only continue if you call the unload function passed in, giving you the chance to cancel the navigation. For example, we attach an unloading function to the 'compose' State of an email application to prevent the user accidentally navigating away before sending their mail.
            </p>
            <pre><code class="language-jsx">stateNavigator.states.compose.unloading = function(state, data, url, unload, history) {
  if (history || confirm('You've not sent your email. Continue?')) {
    unload();
  }
};</code></pre>
            <h2>Doing Async Work</h2>
            <p>
                You can also intercept a navigation by attaching a function to the destination State's navigating property. This gives you a chance to suspend the navigation until an async operation completes. In the email example, when a user opens a mail we fetch the mail data inside a navigating function to avoid displaying a blank screen while it loads. Once the data returns we pass it into the navigate continuation function.
            </p>
            <pre><code class="language-jsx">stateNavigator.states.mail.navigating = function(data, url, navigate, history) {
  $.getJSON('api/mail/' + data.id, function(resp) {
    navigate({mail: resp});
  });
};</code></pre>
            <p>
                The Navigation router passes this asynchrounus data along in the second parameter of the 'mail' State's navigated function.
            </p>
            <pre><code class="language-jsx">stateNavigator.states.mail.navigated = function(data, asyncData) {
  ReactDOM.render(
    &lt;Mail mail={asyncData.mail} />,
    document.getElementById('app'));
};</code></pre>
        </div>
    </div>
    <script type="text/javascript" src="prism.js"></script>
</body>
</html>