<!DOCTYPE html>
<html>
<head>
    <title>Tidying Up the Url</title>
    <link href="codemirror.css" rel="stylesheet" />
    <link href="tutorial.css" rel="stylesheet" />
    <style>
        .CodeMirror { height:395px; }
        #congrats { display: none; }
    </style>
</head>
<body>
    <div id="header">
        <div id="banner">
            <a id="home" href="../index.html">Navigation</a>
            <a class="active" href="configuringstates.html">Tutorial</a>
            <a href="../example/angular/navigation.html">Examples</a>
            <a href="https://github.com/grahammendick/navigation">GitHub Source</a>
        </div>
    </div>
    <div id="content">
        <div id="tutorial">
            <h3>Exercises</h3>
            <ol>
                <li><a id="e1">Configuring States</a></li>
                <li><a id="e2">Accessing States</a></li>
                <li><a id="e3">Navigating to a Dialog</a></li>
                <li><a id="e4">Creating a State Controller</a></li>
                <li><a id="e5">Configuring a Transition</a></li>
                <li><a id="e6">Navigating along a Transition</a></li>
                <li><a id="e7">Navigating Back</a></li>
                <li><a id="e8">Passing Data</a></li>
                <li><a id="e9">Refreshing</a></li>
                <li><a id="e10">Remembering Data</a></li>
                <li><a id="e11">Tidying Up the Url</a></li>
            </ol>
        </div>
        <div id="exercise">
            <h1>Exercise 11: Tidying Up the Url</h1>
            <p>
                If you've been keeping your eyes peeled, you would've noticed the Url change as you ran the exercises. Navigation
                keeps the Url in step with the current State and data. At the end of the previous exercise the Url's hash was set
                to '/people?c1=0-1&pageNumber=22_2&c3=4_0-05_pageNumber1_22_2'. In this exercise, we'll tidy this up so it reads
                '/people/2' instead.
            </p>
            <p>
                Most of the query string can be removed by turning off breadcrumb trail tracking on the listing State. It's safe
                to turn it off because you don't need to navigate back from the listing State. You can tidy up the rest of the Url
                by changing the listing State's route and setting a default value for pageNumber. Make sure you check the Url after
                successfully completing this exercise.
            </p>
            <div id="congrats">
                <h2>Congratulations!</h2>
                <p>
                    You've finished the tutorial. Before you start using Navigation you should know about Navigation plugins. These
                    plugins bridge the gap between your UI binding library of choice and the Navigation library. They let you use the
                    binding syntax you're familiar with to build navigation Hyperlinks. Here's a Hyperlink that navigates back from
                    the details State to the listing State using the React Navigation plugin:
                    <code>&lt;NavigationBackLink distance="1"&gt;People&lt;/NavigationBackLink&gt;</code>
                    There are currently plugins for Angular, Knockout and React. To see them in action I've built the SPA from this
                    tutorial using each of these libraries.
                </p>
                <ul>
                    <li><a href="../example/angular/navigation.html">Navigation Angular Example</a></li>
                    <li><a href="../example/knockout/navigation.html">Navigation Knockout Example</a></li>
                    <li><a href="../example/react/navigation.html">Navigation React Example</a></li>
                </ul>
                <p>
                    If you've got any questions about this tutorial or would like to write a plugin for your UI library, get in
                    touch <a href="https://twitter.com/grahammendick">@grahammendick.</a>
                </p>
            </div>
            <textarea id="code"></textarea>
            <button id="run">Run</button>
            <button id="cheat">Cheat</button>
            <button id="next">Next</button>
        </div>
    </div>
    <script>
        var tutorial = {
            part: 11,
            exercise:
"function(result){\n\
	/*-------------------------EXERCISE-------------------------\n\
	 * Tidy up the listing State's Url so it reads '/people/2'.\n\
	 * Breadcrumb trail tracking has already been turned off by\n\
	 * setting 'trackCrumbTrail' to false. Finish the job by\n\
	 * setting the listing State's route and the pageNumber's\n\
     * default value to 1.\n\
	 */\n\
	Navigation.StateInfoConfig.build([{\n\
		key: '{dialog}', initial: '{listing}', states: [\n\
			{ key: '{listing}', route: '?', \n\
				defaults: { ? }, \n\
				trackCrumbTrail: false, transitions: [\n\
				{ key: '{transition}', to: '{details}' }\n\
			]},\n\
    		{ key: '{details}', route: 'person/{id}', \n\
				defaults: { id: 0 } }\n\
		]\n\
	}]);\n\
	Navigation.StateController.navigate('{dialog}');\n\
	Navigation.StateController.refresh({ pageNumber: 2 });\n\
	Navigation.StateController.navigate('{transition}');\n\
	Navigation.StateController.navigateBack(1);\n\
}",
            answer:
"function(result){\n\
	Navigation.StateInfoConfig.build([{\n\
		key: '{dialog}', initial: '{listing}', states: [\n\
			{ key: '{listing}', route: 'people/{pageNumber}', \n\
				defaults: { pageNumber: 1 }, \n\
				trackCrumbTrail: false, transitions: [\n\
				{ key: '{transition}', to: '{details}' }\n\
			]},\n\
    		{ key: '{details}', route: 'person/{id}', \n\
				defaults: { id: 0 } }\n\
		]\n\
	}]);\n\
	Navigation.StateController.navigate('{dialog}');\n\
	Navigation.StateController.refresh({ pageNumber: 2 });\n\
	Navigation.StateController.navigate('{transition}');\n\
	Navigation.StateController.navigateBack(1);\n\
}",
            test: function (listing, details, result, lastState) {
                document.getElementById('congrats').style.display = 'none';
                if (Navigation.StateContext.url !== '/people/2')
                    throw "The current url isn't '/people/2'";
                if (listing.defaults.pageNumber !== 1)
                    throw "The pageNumber default isn't 1";
                if (Navigation.StateContext.data.pageNumber !== 2)
                    throw "You didn't remember a pageNumber of 2";
                if (Navigation.StateContext.state !== listing)
                    throw "The current State isn't the listing State";
                if (lastState !== details)
                    throw "The previous State isn't the details State";
                document.getElementById('congrats').style.display = 'block';
            }
        }
    </script>
    <script src="navigation.js"></script>
    <script src="codemirror.js"></script>
    <script src="javascript.js"></script>
    <script src="tutorial.js"></script>
</body>
</html>
