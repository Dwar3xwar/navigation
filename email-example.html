<html>
<head>
    <title>Email Example</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="prism.css">
    <link rel="stylesheet" href="navigation.css">
</head>
<body>
    <div id="banner">
        <div>
            <a href="index.html">Navigation</a>
            <a href="hello-world.html" class="selected">Docs</a>
            <a href="download.html">Download</a>
            <a id="github" href="https://github.com/grahammendick/navigation">GitHub source</a>
        </div>
    </div>
    <div id="content">
        <div id="menu">
            <a href="hello-world.html">Hello World</a>
            <div class="separator"></div>
            <h2>THE ABC</h2>
            <a href="state-navigation.html">A. State Navigation</a>
            <a href="navigation-data.html">B. Navigation Data</a>
            <a href="routes.html">C. Routes</a>
            <div class="separator"></div>
            <h2>FURTHER GUIDES</h2>
            <a href="breadcrumb-trail.html" class="selected">Breadcrumb Trail</a>
            <a href="current-data.html">Current Data</a>
            <a href="html5-history.html">HTML5 History</a>
            <a href="navigation-lifecycle.html">Navigation Lifecycle</a>
        </div>
        <div id="article">
            <h1>Email Example</h1>
            <p>
                Example built in preceding documents. Async calls simulated with a setTimeout...
            </p>
            [Inline Js Fiddle]
            <div id="example"></div>
        </div>
    </div>
    <script type="text/javascript" src="prism.js"></script>
    <script type="text/javascript" src="example/react/react-0.14.3.min.js"></script>
    <script type="text/javascript" src="example/react/react-dom-0.14.3.min.js"></script>
    <script type="text/javascript" src="example/react/JSXTransformer-0.13.3.js"></script>
    <script type="text/javascript" src="navigation.js"></script>
    <script type="text/javascript" src="navigation.react.js"></script>
    <script type="text/jsx">
        var StateNavigator = Navigation.StateNavigator;
        var NavigationBackLink = NavigationReact.NavigationBackLink;
        var NavigationLink = NavigationReact.NavigationLink;
        var RefreshLink = NavigationReact.RefreshLink;
        
        function getMails() {
            return [
                {id: 1, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,1), content: 'Blah blah blah'},
                {id: 2, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,2), content: 'Blah blah blah'},
                {id: 3, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,3), content: 'Blah blah blah'},
                {id: 4, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,4), content: 'Blah blah blah'},
                {id: 5, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,5), content: 'Blah blah blah'},
                {id: 6, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,6), content: 'Blah blah blah'},
                {id: 7, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,7), content: 'Blah blah blah'},
                {id: 8, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,8), content: 'Blah blah blah'},
                {id: 9, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,9), content: 'Blah blah blah'},
                {id: 10, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,10), content: 'Blah blah blah'},
                {id: 11, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,11), content: 'Blah blah blah'},
                {id: 12, from: 'brenda@home.com', to: 'me', subject: 'You\'ve gotta see this', date: new Date(2016,3,12), content: 'Blah blah blah'},
            ];
        }
        
        var App = React.createClass({
            render: function () {
                return (
                    <div>
                        <ul>
                            <li>
                                <NavigationLink 
                                    stateNavigator={this.props.stateNavigator}
                                    disableActive={true}
                                    stateKey="inbox">
                                    Inbox
                                </NavigationLink>
                            </li>
                            <li>
                                <NavigationLink 
                                    stateNavigator={this.props.stateNavigator}
                                    disableActive={true}
                                    stateKey="compose">
                                    Compose
                                </NavigationLink>
                            </li>
                        </ul>
                        <div id="view"></div>
                    </div>
                );
            }
        });
        
        var Inbox = React.createClass({
            render: function() {
                var mails = this.props.mails.map(function(mail) {
                    return (
                        <tr>
                            <td>{mail.from}</td>
                            <td>
                                <NavigationLink 
                                    stateNavigator={this.props.stateNavigator} 
                                    navigationData={{id: mail.id}}
                                    stateKey="mail">
                                    {mail.subject}
                                </NavigationLink>
                            </td>
                            <td>{mail.date.toDateString()}</td>
                        </tr>
                    );
                }.bind(this));
                return (
                    <div>
                        <h1>Inbox</h1>
                        <table>
                            <thead>
                                <tr>
                                    <th>From</th>
                                    <th>Subject</th>
                                    <th>Sent</th>
                                </tr>
                            </thead>
                            <tbody>{mails}</tbody>
                        </table>
                    </div>
                );
            }
        });
        
        var Mail = React.createClass({
            render: function () {
                return (
                    <div>
                        <NavigationBackLink 
                            stateNavigator={stateNavigator} 
                            distance={1}>
                            Back to Inbox
                        </NavigationBackLink>
                        <div>
                            <h1>{this.props.mail.subject}</h1>
                            <div>{this.props.mail.date.toDateString()}</div>
                            <p>{this.props.mail.content}</p>
                        </div>
                    </div>
                );
            }
        });
        
        var Compose = React.createClass({
            getInitialState: function() {
                return {value: ''};
            },
            handleChange: function(event) {
                this.setState({value: event.target.value});
            },
            handleSend: function(event) {
                this.setState({value: ''}, function() {
                    this.props.stateNavigator.navigate('inbox');
                });
            },
            componentDidMount: function() {
                this.props.stateNavigator.states.compose.unloading = function(state, data, url, unload, history) {
                    if (history || !this.state.value || confirm('You\'ve not sent your email. Continue?')) {
                        unload();
                    }
                }.bind(this);
            }, 
            render: function () {
                return (
                    <div>
                        <h1>Compose</h1>
                        <textarea 
                            rows="6"
                            cols="60"
                            value={this.state.value}
                            onChange={this.handleChange}>
                        </textarea>
                        <button onClick={this.handleSend}>Send</button>
                    </div>
                );
            }
        });
        
        var stateNavigator = new StateNavigator([
            {key: 'inbox', route: '', title: 'Inbox'},
            {key: 'mail', trackCrumbTrail: true},
            {key: 'compose', title: 'Compose'}
        ]);
        
        stateNavigator.states.inbox.navigating = function(data, url, navigate) {
            setTimeout(function() {
                var mails = getMails();
                navigate({mails: mails});
            }, 100);
        };
        
        stateNavigator.states.inbox.navigated = function(data, asyncData) {
            ReactDOM.render(
                <Inbox stateNavigator={stateNavigator} mails={asyncData.mails} />,
                document.getElementById('view'));
        };
        
        stateNavigator.states.mail.navigating = function(data, url, navigate) {
            setTimeout(function() {
                var mail = getMails().filter(function(mail) {
                    return mail.id === data.id;
                })[0];
                navigate({mail: mail});
            }, 100);
        };
        
        stateNavigator.states.mail.navigated = function(data, asyncData) {
            stateNavigator.stateContext.title = asyncData.mail.subject;
            ReactDOM.render(
                <Mail stateNavigator={stateNavigator} mail={asyncData.mail} />,
                document.getElementById('view'));
        };
        
        stateNavigator.states.compose.navigated = function() {
            ReactDOM.render(
                <Compose stateNavigator={stateNavigator} />,
                document.getElementById('view'));
        };
        
        ReactDOM.render(
            <App stateNavigator={stateNavigator} />,
            document.getElementById('example'));
        stateNavigator.start();
    </script>
</body>
</html>