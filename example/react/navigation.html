<!DOCTYPE html>
<html>
<head>
    <title>Navigation React</title>
    <link href="../example.css" rel="stylesheet" />
</head>
<body>
    <div id="header">
        <div id="banner">
            <a id="home" href="../../index.html">Navigation</a>
            <a href="../../tutorial/configuringstates.html">Tutorial</a>
            <a class="active" href="../angular/navigation.html">Examples</a>
            <a href="../../download/index.html">Download</a>
            <a href="../../documentation/configuring.html">Documentation</a>
            <a href="https://github.com/grahammendick/navigation">GitHub Source</a>
        </div>
    </div>
    <div id="content">
        <div id="example">
            <h3>Examples</h3>
            <ul>
                <li><a href="../angular/navigation.html">Navigation Angular</a></li>
                <li><a href="../knockout/navigation.html">Navigation Knockout</a></li>
                <li id="menuItem" class="active"></li>
            </ul>
        </div>
        <div id="plugin">
            <h1>Navigation React</h1>
            <p>
                This is the SPA from the <a href="../../tutorial/configuringstates.html">tutorial</a>, built using the 
                Navigation React plugin. View the source of the page to see the code, annotated with comments that tie 
                it back to the exercises from the tutorial. The plugin makes it easy to build navigating Hyperlinks using 
                React syntax. Here's the Hyperlink that goes to page 2:
                <code>&lt;RefreshLink toData={{ pageNumber: 2 }}&gt;2&lt;/RefreshLink&gt;</code>
            </p>
            <div id="navigation">
                <div id="view"></div>
            </div>
        </div>
    </div>
    <script src="../personSearch.js"></script>
    <script src="react-0.13.3.min.js"></script>
    <script src="JSXTransformer-0.13.3.js"></script>
    <script src="../../navigation.js"></script>
    <script src="navigation.react.js"></script>
    <script type="text/jsx">
        var NavigationBackLink = NavigationReact.NavigationBackLink;
        var NavigationLink = NavigationReact.NavigationLink;
        var RefreshLink = NavigationReact.RefreshLink;
        var MenuItem = React.createClass({
            render: function () {
                return (
                    // Exercise 3: Navigating to a Dialog
                    <NavigationLink action="masterDetails">Navigation React</NavigationLink>
                );
            }
        });
        var Listing = React.createClass({
            shouldComponentUpdate: function(nextProps) {
                return nextProps.pageNumber !== this.props.pageNumber;
            },
            render: function () {
                var people = personSearch.getList();
                var start = (this.props.pageNumber - 1) * 10;
                people = people.slice(start, start + 10);
                people = people.map(function (person) {
                    return (
                        <tr>
                            {/* Exercise 6: Navigating along a Transition */}
                            {/* Exercise 8: Passing Data */}
                            <td><NavigationLink action="select" toData={{ id: person.id }}>{person.name}</NavigationLink></td>
                            <td>{person.dateOfBirth}</td>
                        </tr>
                    );
                });
                return (
                    <div id="listing">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Date of Birth</th>
                                </tr>
                            </thead>
                            <tbody>{people}</tbody>
                        </table>
                        <div id="pager">
                            Go to page
                            {/* Exercise 9: Refreshing */}
                            <RefreshLink toData={{ pageNumber: 1 }} disableActive={true}>1</RefreshLink>
                            <RefreshLink toData={{ pageNumber: 2 }} disableActive={true}>2</RefreshLink>
                        </div>
                    </div>
                );
        }
        });
        var Details = React.createClass({
            shouldComponentUpdate: function(nextProps) {
                return nextProps.id !== this.props.id;
            },
            render: function () {
                var person = personSearch.getDetails(this.props.id);
                return (
                    <div id="details">
                        {/* Exercise 7: Navigating Back */}
                        {/* Exercise 10: Remembering Data */}
                        <NavigationBackLink distance={1}>People</NavigationBackLink>
                        <div id="info">
                            <h2>{person.name}</h2>
                            <div className="label">Date of Birth</div>
                            <div>{person.dateOfBirth}</div>
                            <div className="label">Email</div>
                            <div>{person.email}</div>
                            <div className="label">Phone</div>
                            <div>{person.phone}</div>
                        </div>
                    </div>
                );
            }
        });        
        // Exercise 1: Configuring States
        // Exercise 5: Configuring a Transition
        // Exercise 11: Tidying Up the Url
        var dialogs = [{
            key: 'masterDetails', initial: 'listing', states: [
                { key: 'listing', route: '{pageNumber}',
                    defaults: { pageNumber: 1 },
                    trackCrumbTrail: false, transitions: [
                    { key: 'select', to: 'details' }
                    ]},
                { key: 'details', route: 'person/{id}',
                    defaults: { id: 0 } }
            ]
        }];
        Navigation.StateInfoConfig.build(dialogs);
        React.render(
            <MenuItem />,
            document.getElementById('menuItem')
        );
        // Exercise 2: Accessing States
        // Exercise 4: Creating a State Controller
        var personStates = Navigation.StateInfoConfig.dialogs.masterDetails.states;
        personStates.listing.navigated = function (data) {
            React.render(
                <Listing pageNumber={data.pageNumber} />,
                document.getElementById('view')
            );
        };
        personStates.details.navigated = function (data) {
            React.render(
                <Details id={data.id} />,
                document.getElementById('view')
            );
        };
        Navigation.start();
    </script>
</body>
</html>
