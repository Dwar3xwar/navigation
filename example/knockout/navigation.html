<!DOCTYPE html>
<html>
<head>
    <title>Navigation Knockout</title>
    <link href="../example.css" rel="stylesheet" />
</head>
<body>
    <div id="header">
        <div id="banner">
            <a id="home" href="../../index.html">Navigation</a>
            <a href="../../tutorial/configuringstates.html">Tutorial</a>
            <a class="active" href="../angular/navigation.html">Examples</a>
            <a href="../../download/index.html">Download</a>
            <a href="../../documentation/configuring.html">Documentation</a>
            <a href="https://github.com/grahammendick/navigation">GitHub Source</a>
        </div>
    </div>
    <div id="content">
        <div id="example">
            <h3>Examples</h3>
            <ul>
                <li><a href="../angular/navigation.html">Navigation Angular</a></li>
                <!-- Exercise 3: Navigating to a Dialog -->
                <li class="active"><a data-bind="navigationLink: 'masterDetails'">Navigation Knockout</a></li>
                <li><a href="../react/navigation.html">Navigation React</a></li>
            </ul>
        </div>
        <div id="plugin">
            <h1>Navigation Knockout</h1>
            <p>
                This is the SPA from the <a href="../../tutorial/configuringstates.html">tutorial</a>, built using the 
                Navigation Knockout plugin. View the source of the page to see the code, annotated with comments that tie 
                it back to the exercises from the tutorial. The plugin makes it easy to build navigating Hyperlinks using 
                Knockout syntax. Here's the Hyperlink that goes to page 2:
                <code>&lt;a data-bind="refreshLink: { pageNumber: 2 }"&gt;2&lt;/a&gt;</code>
            </p>
            <div id="navigation">
                <div id="listing" data-bind="ifnot: id">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Date of Birth</th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: people">
                            <tr>
                                <!-- Exercise 6: Navigating along a Transition -->
                                <!-- Exercise 8: Passing Data -->
                                <td><a data-bind="text: name, navigationLink: 'select', toData: { id: id }"></a></td>
                                <td data-bind="text: dateOfBirth"></td>
                            </tr>
                        </tbody>
                    </table>
                    <div id="pager">
                        Go to page
                        <!-- Exercise 9: Refreshing -->
                        <a data-bind="refreshLink: { pageNumber: 1 }, disableActive: true">1</a>
                        <a data-bind="refreshLink: { pageNumber: 2 }, disableActive: true">2</a>
                    </div>
                </div>
                <div id="details" data-bind="if: id">
                    <!-- Exercise 7: Navigating Back -->
                    <!-- Exercise 10: Remembering Data -->
                    <a data-bind="navigationBackLink: 1">People</a>
                    <div id="info" data-bind="with: person">
                        <h2 data-bind="text: name"></h2>
                        <div class="label">Date of Birth</div>
                        <div data-bind="text: dateOfBirth"></div>
                        <div class="label">Email</div>
                        <div data-bind="text: email"></div>
                        <div class="label">Phone</div>
                        <div data-bind="text: phone"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../personSearch.js"></script>
    <script src="knockout-3.3.0.js"></script>
    <script src="../../navigation.js"></script>
    <script src="navigation.knockout.js"></script>
    <script>
        function PersonViewModel() {
            var self = this;
            self.id = ko.observable();
            self.people = ko.observableArray();
            self.person = ko.observable();
            // Exercise 2: Accessing States
            // Exercise 4: Creating a State Controller
            var personStates = Navigation.StateInfoConfig.dialogs.masterDetails.states;
            personStates.listing.navigated = function (data) {
                var people = personSearch.getList();
                var start = (data.pageNumber - 1) * 10;
                self.people(people.slice(start, start + 10));
            };
            personStates.details.navigated = function (data) {
                self.id(data.id);
                self.person(personSearch.getDetails(data.id));
            };
            personStates.details.dispose = function () { self.id(null); };
        }
        // Exercise 1: Configuring States
        // Exercise 5: Configuring a Transition
        // Exercise 11: Tidying Up the Url
        var dialogs = [{
    	    key: 'masterDetails', initial: 'listing', states: [
    		    { key: 'listing', route: '{pageNumber}', 
    			    defaults: { pageNumber: 1 }, 
    			    trackCrumbTrail: false, transitions: [
    			    { key: 'select', to: 'details' }
    		    ]},
    		    { key: 'details', route: 'person/{id}', 
    			    defaults: { id: 0 } }
    	    ]
        }];
        Navigation.StateInfoConfig.build(dialogs);
        ko.applyBindings(new PersonViewModel());
        Navigation.start();
    </script>
</body>
</html>
